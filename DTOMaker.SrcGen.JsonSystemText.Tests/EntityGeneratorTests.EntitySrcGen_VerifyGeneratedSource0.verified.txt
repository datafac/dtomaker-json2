// <auto-generated>
// This file was generated by DTOMaker.JsonSystemText.
// NuGet: https://www.nuget.org/packages/DTOMaker.JsonSystemText
// Warning: Changes made to this file will be lost if re-generated.
// </auto-generated>
#pragma warning disable CS0109 // Member does not hide an inherited member; new keyword is not required
#nullable enable
using DataFac.Memory;
using DTOMaker.Runtime;
using DTOMaker.Runtime.JsonSystemText;
using System;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Text.Json.Serialization;
using MyOrg.Models;

namespace MyOrg.Models
{
    [JsonPolymorphic]
    [JsonDerivedType(typeof(Derived), 2)]
    [JsonDerivedType(typeof(MyDTO), 1)]
    [JsonDerivedType(typeof(Other3), 3)]
    [JsonDerivedType(typeof(Other4), 4)]
    public class EntityBase : IEntityBase, IEquatable<EntityBase>
    {
        // Derived entities: 4
        // - Derived
        // - MyDTO
        // - Other3
        // - Other4
        protected virtual int OnGetEntityId() => 0;
        public int GetEntityId() => OnGetEntityId();

        private static EntityBase CreateEmpty()
        {
            var empty = new EntityBase();
            empty.Freeze();
            return empty;
        }
        private static readonly EntityBase _empty = CreateEmpty();
        public static EntityBase Empty => _empty;

        public static EntityBase CreateFrom(EntityBase source)
        {
            if (source.IsFrozen) return source;
            return source switch
            {
                MyOrg.Models.Derived source2 => new MyOrg.Models.Derived(source2),
                MyOrg.Models.MyDTO source2 => new MyOrg.Models.MyDTO(source2),
                MyOrg.Models.Other3 source2 => new MyOrg.Models.Other3(source2),
                MyOrg.Models.Other4 source2 => new MyOrg.Models.Other4(source2),
                _ => new EntityBase(source)
            };
        }

        public new static EntityBase CreateFrom(IEntityBase source)
        {
            if (source is EntityBase concrete && concrete.IsFrozen) return concrete;
            return source switch
            {
                MyOrg.Models.IDerived source2 => new MyOrg.Models.Derived(source2),
                MyOrg.Models.IMyDTO source2 => new MyOrg.Models.MyDTO(source2),
                MyOrg.Models.IOther3 source2 => new MyOrg.Models.Other3(source2),
                MyOrg.Models.IOther4 source2 => new MyOrg.Models.Other4(source2),
                _ => new EntityBase(source)
            };
        }

        public new static EntityBase CreateNewFromId(int entityId)
        {
            if (entityId == 0) return new EntityBase();
            if (entityId == 1) return new MyOrg.Models.MyDTO();
            if (entityId == 2) return new MyOrg.Models.Derived();
            if (entityId == 3) return new MyOrg.Models.Other3();
            if (entityId == 4) return new MyOrg.Models.Other4();
            throw new InvalidOperationException($"EntityId '{entityId}' is not valid.");
        }

        public EntityBase() { }
        public EntityBase(IEntityBase notUsed) { }
        public EntityBase(EntityBase notUsed) { }

        private volatile bool _frozen;
        [JsonIgnore] public bool IsFrozen => _frozen;
        protected virtual void OnFreeze() { }
        public void Freeze()
        {
            if (_frozen) return;
            OnFreeze();
            _frozen = true;
        }
        protected virtual IEntityBase OnPartCopy() => new EntityBase(this);
        public IEntityBase PartCopy() => OnPartCopy();

        [MethodImpl(MethodImplOptions.NoInlining)]
        private void ThrowIsFrozenException(string? methodName) => throw new InvalidOperationException($"Cannot set {methodName} when frozen.");

        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        protected T IfNotFrozen<T>(T value, [CallerMemberName] string? methodName = null)
        {
            if (_frozen) ThrowIsFrozenException(methodName);
            return value;
        }

        public bool Equals(EntityBase? other) => true;
        public override bool Equals(object? obj) => obj is EntityBase;
        public override int GetHashCode() => HashCode.Combine<Type>(typeof(EntityBase));

        protected static bool BinaryValuesAreEqual(byte[]? left, byte[]? right)
        {
            if (left is null) return (right is null);
            if (right is null) return false;
            return left.AsSpan().SequenceEqual(right.AsSpan());
        }

    }
}
